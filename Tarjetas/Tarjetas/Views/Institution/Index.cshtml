@{
    ViewBag.Title = "Home Page";
}
		
<card class="card">
	<nav class="navbar navbar-light bg-light navbar-expand-lg">
  <h3>ADMIN</h3>		
    <ul class="navbar-nav mr-0 ml-5">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Configuraciones
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#"  data-toggle="modal" data-target="#modalInstitucion" >Instituciones</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#" data-toggle="modal" data-target="#modalTarjetas" >Tarjetas</a>
        </div>
      </li>
    </ul>
</nav>	
</card>




<!-- MODALES -->

<!-- MODALES INSTITUCION -->

<!-- MODAL BUSCAR INSTITUCION -->

<div class="modal  fade" id="modalInstitucion" tabindex="-1" role="dialog" aria-labelledby="modalInstitucio" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Consultar Institución</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		  <div class="form-group">
			<label for="institucion" class="d-block ">Institución</label>
			<input type="text" id="txtInstitucion"  class="form-control d-inline" id="institucion" aria-describedby="Institución" placeholder="Ingrese Institución">
		  <button type="submit" class="btn btn-primary ml-5" id="btnBuscar">Buscar</button>
		  <button type="submit" class="btn btn-primary mt-3 d-block " id="btnRegistrar" data-toggle="modal" data-target="#modalRegistrarInstitucion">Registrar</button>

		  </div>
		  	<table class="table d-none" id="tablaInstitucion"> 
			  <thead>
				<tr>
				  <th scope="col">ID</th>
				  <th scope="col">NOMBRE</th>
				  <th scope="col">IDENTIFICADOR</th>
				  <th scope="col">ES ACTIVO</th>
				  <th scope="col">USUARIO</th>
				  <th scope="col">FECHA</th>
				</tr>
			  </thead>
			  <tbody id ="tbodyInstituciones">
			  <tr id= "trInstituciones">
			  </tr>
		</tbody>
		</table>
      </div>
    </div>
  </div>
</div>

<!-- MODAL AGREGAR INSTITUCION -->

<div class="modal  fade" id="modalRegistrarInstitucion" tabindex="-1" role="dialog" aria-labelledby="modalInstitucio" aria-hidden="true">
<div class="modal-dialog  modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Registrar Institución</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		  <div class="form-group">
			<label for="txtNombre" class="d-block ">Nombre</label>
			<input type="text" id="txtNombre"  class="form-control d-inline"  aria-describedby="Nombre" placeholder="Ingrese Nombre">
			<label for="txtIdentificador" class="d-block mt-3">Institución</label>
			<input type="text" id="txtIdentificador"  class="form-control d-inline" aria-describedby="Identificador" placeholder="Ingrese identificador">
			<button type="submit" class="btn btn-primary mt-4" id="btnAgregar">Registrar</button>

      </div>
    </div>
  </div>
</div>

<!-- MODAL BUSCAR TARJETAS -->

<div class="modal  fade" id="modalTarjetas" tabindex="-1" role="dialog" aria-labelledby="modalTarjetas" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Tarjetas</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		  <div class="form-group">
			<label for="tarjetas" class="d-block ">Tarjetas</label>
			<input type="text" class="form-control d-inline" id="tarjetas" aria-describedby="Tarjetas" placeholder="Ingrese Tarjeta">
		  <button type="submit" class="btn btn-primary ml-5">Buscar</button>
		  </div>
			<table class="table">
			  <thead>
				<tr>
				  <th scope="col">ID</th>
				  <th scope="col">NOMBRE</th>
				  <th scope="col">IDENTIFICADOR</th>
				  <th scope="col">ES ACTIVO</th>
				  <th scope="col">USUARIO</th>
				  <th scope="col">FECHA</th>
				</tr>
			  </thead>
			  <tbody>
			  @for(var i=0;i<ViewBag.institucions.Count;i++){
				  <tr>
				  <th scope="row">@ViewBag.institucions[0].ID</th>
				  <td>@ViewBag.institucions[i].Nombre</td>
				  <td>@ViewBag.institucions[i].Identificador</td>
				  <td>@ViewBag.institucions[i].EsActivo</td>
				  <td>@ViewBag.institucions[i].Usuario</td>
				  <td>@ViewBag.institucions[i].Fecha.ToString("yyyy-MM-dd")</td>
				</tr>	
			  }
		  </tbody>
		</table>
      </div>
    </div>
  </div>
</div>

@section scripts {
<script>
    $(function () {
        document.querySelector("#btnBuscar").addEventListener("click", function () {
		var institucion = $("#txtInstitucion").val()
		if(institucion == ""){
			alert("CAMPO VACÍO")
			return
		}
		    $.ajax(  
        {  
            type: 'POST',  
            url: '@Url.Action("GetInstitution")',  
            data: { institucion : institucion},  
            success:  
                function (res)  
                {  
					if(res.length == 0){
						alert("NO SE ENCONTRO INSTITUCION")
						if(!$("#tablaInstitucion").hasClass("d-none")){
							$("#tablaInstitucion").addClass("d-none")
						}s
						return
					}
					var tbody = $("#tablaInstitucion tbody")
					tbody.empty()
					var cadena = '<tr>'
					for(var i=0; i < res.length; i++){
						cadena += '<th scope="row">' + res[i].ID + '</th>'
						cadena += '<td>' + res[i].Nombre + '</td>'
						cadena += '<td>' + res[i].Identificador + '</td>'
						cadena += '<td>' + res[i].EsActivo + '</td>'
						cadena += '<td>' + res[i].Usuario + '</td>'
						cadena += '<td>' +	res[i].Fecha
						cadena+='<button type="button" id="btnModificar" class="btn btn-outline-secondary waves-effect px-3 ml-4">Editar</button> <button type="button" class="btn btn-outline-secondary waves-effect px-3 ml-4"  id="btnEliminar">Eliminar</button</td>'
					}
					cadena += '</tr>'
					tbody.append(cadena)

					$("#tablaInstitucion").removeClass("d-none")
                },  
            error:  
                function (res)  
                {  
                    alert("Error: " + res);  
                }  
        }); 
        });

		document.querySelector("#btnAgregar").addEventListener("click", function () {
		var nombre = $("#txtNombre").val()
		var identificador = $("#txtIdentificador").val()
		if(nombre == "" || identificador == "" ){
			alert("CAMPO VACÍO")
			return	
		}
		    $.ajax(  
        {  
            type: 'POST',  
            url: '@Url.Action("AddInstitution")',  
            data: { nombre : nombre, identificador: identificador, usuario : "jreyes"},  
            success:  
                function (res)  {
					alert(res.resultMessage)
					$("#txtIdentificador").val("")
					$("#txtNombre").val("")
					return
                },  
            error:  
                function (res)  
                {  
                    alert(JSON.stringify(res))
                }  
        }); 
        });
    });

</script>
    }